<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online camera market</title>
    <link rel="stylesheet" href="index.css">
    <link href="https://fonts.googleapis.com/css2?family=Quantico&family=Roboto&family=Varela+Round&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-..." crossorigin="anonymous">
   
    <style>
        body {
            background-color: #e4dfdf;
        }
        .form-control {
            width: 400px;
        }
        .navbar .navbar-collapse {
            justify-content: flex-end;
        }
        .navbar .navbar-collapse .navbar-nav {
            align-items: center;
        }
        .navbar .navbar-collapse .navbar-nav .form-group {
            margin: 0;
            display: flex;
            align-items: center;
        }
        .navbar .navbar-collapse .navbar-nav .form-group .form-control {
            margin-right: 5px;
        }
        .scroll-lock {
            overflow-x: hidden;
            overflow-y: scroll;
        }
        
        .carousel {
            width: 100%; 
            overflow: hidden;
            position: relative;
            height: 450px; 
            background-color: black;
        }
        
        .carousel_inner {
            display: flex;
            transition: transform 0.5s ease;
        }
        
        .carousel_item {
            min-width: 100%;
            width: 100%;
            height: 100%;
            flex: 0 0 auto;
        }
        
        .carousel_img {
            width: 100%;
            height: 56.6%;
            object-fit: cover; 
        }
        
        #bt {
            color: white;
            padding: 0 10px;
        }
        /* CSS styles for the username element */
    #username {
    display: inline-table;
    margin-left: 10px;
    font-weight: bold;
    color: #fff3f3; /* Change color as needed */
    }
    #userContainer {
        display: inline-block;
    }
    @media screen and (max-width: 768px) {
        .carousel {
            display: none;
        }
        body {
            background-color: black; /* Change background color to black on mobile */
        }}
        
    </style>

    <script src="https://kit.fontawesome.com/3318035e44.js"></script>
</head>
<body>

   <nav class="navbar navbar-expand-lg navbar-dark bg-black">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <img src="assets/logo1.png" alt=" Logo">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <form class="form-inline my-2 my-lg-0 mx-auto search-form">
                <div class="form-group">
                    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-light my-2 my-sm-0" type="submit">Search</button>
                </div>
            </form>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="login.html">
                        <i class="fa-solid fa-user" id="bt">Login</i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="signup.html">
                        <i class="fa-solid fa-user-plus" id="bt">Signup</i>
                    </a>
                    
                </li>
                
                <li class="nav-item " id="userContainer">
                    <a class="nav-link" id="logoutBtn" style="display: none;" href="#"  onclick="logoutUser()">
                        <i class="fas fa-sign-out-alt" id="bt">Logout
                        </i>
                    </a>
                </li>
                            <li class="nav-item">
                    <div class="cart-btn">
                        <span class="nav-icon">
                            
                            <i class="fas fa-cart-plus" id="bt"> </i>
                        </span> 
                        <div class="cart-items" id="bt">0</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>

    <div class="home">
        <section class="hero-section">
            <div class="carousel" >
                <div class="carousel_inner">
                    
                    <div class="carousel_item">
                        <img src="assets/hero_image.jpg" alt="" class="carousel_img">
                    </div>
                    <div class="carousel_item">
                        <img src="assets/slide1.png" alt="" class="carousel_img">
                    </div>
                    <div class="carousel_item">
                        <img src="assets/slide2.png" alt="" class="carousel_img">
                    </div>
                    <div class="carousel_item">
                        <img src="assets/slide3.png" alt="" class="carousel_img">
                    </div>
                    <div class="carousel_item">
                        <img src="assets/slide4.jpg" alt="" class="carousel_img">
                    </div>
                </div>
            </div>
        </section>   
        
       
        <section class="products">
            <div class="section-title">
                <h2>Our Products</h2>
            </div>
            <div class="products-center">
                
            </div>
        </section> 
        
            <div class="cart-overlay">
                <div class="cart">
                   <span class="close-cart">
                       <i class="fas fa-arrow-left"></i>
                   </span> 
                   <h2>Your cart</h2>
                   <div class="cart-content">
                      <!-- cart item -->
                    
                   </div>
                    <div class="cart-footer">
                        <h3>your total: $ <span class="cart-total">0</span></h3>
                        <button class="clear-cart banner-btn">clear cart</button>
                        <a href="buynow.html"><button class="buy-cart banner-btn" >BUY NOW</button></a>
                    </div>
                </div>
            </div>
       
      
       
        
        
    </div>
    

    <script>
        
        const carousel = document.querySelector('.carousel');
        const carouselInner = document.querySelector('.carousel_inner');
        const items = document.querySelectorAll('.carousel_item');
        const totalItems = items.length;
        let slideWidth = items[0].clientWidth;
        let currentIndex = 0;

        function slideNext() {
            currentIndex = (currentIndex + 1) % totalItems;
            updateCarousel();
        }

        function updateCarousel() {
            carouselInner.style.transform = `translateX(-${currentIndex * slideWidth}px)`;
        }

        setInterval(slideNext, 3000); 

        const searchInput = document.querySelector(".form-control");
        const productsContainer = document.querySelector(".products-center");

        function filterProducts() {
            const searchTerm = searchInput.value.toLowerCase();
            const products = document.querySelectorAll(".product");

            products.forEach(product => {
                const title = product.querySelector("h3").textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    product.style.display = "block";
                } else {
                    product.style.display = "none";
                }
            });
        }

        searchInput.addEventListener("input", filterProducts);



        
    </script>

    <script>
        // Fetch products from the server
        document.addEventListener("DOMContentLoaded", () => {
            const productsDOM = document.querySelector(".products-center");

            // Fetch products and display them
            fetch("/products")
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const products = data.items; // Assuming products are nested under 'items'
                    let result = "";
                    products.forEach(product => {
                        result += `
                            <article class="product">
                                <div class="img-container">
                                    <img src="${product.fields.image.fields.file.url}" alt="product" class="product-img">
                                    <button class="bag-btn" onclick=${product.sys.id}>
                                        <i class="fas fa-shopping-cart"></i>
                                        add to cart
                                    </button>
                                </div> 
                                <h3>${product.fields.title}</h3>
                                <h4>$${product.fields.price}</h4>
                            </article>
                        `;
                    });
                    productsDOM.innerHTML = result;
                })
                .catch(error => {
                    console.error('Error fetching products:', error);
                    // Handle error, such as displaying a message to the user
                });
        });


        document.addEventListener("DOMContentLoaded", () => {
            const cartContent = document.querySelector('.cart-content');

            fetch("/user/cart")
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(cartItems => {
                    let result = '';
                    cartItems.forEach(item => {
                        result += `
                            <div class="cart-item">
                                <img src="${item.image}" alt="product">
                                <div>
                                    <h4>${item.title}</h4>
                                    <h5>$${item.price}</h5>
                                    <span class="remove-item" data-id="${item.id}">remove</span>
                                </div>
                                <div>
                                    <i class="fas fa-chevron-up" data-id="${item.id}"></i>
                                    <p class="item-amount">${item.quantity}</p>
                                    <i class="fas fa-chevron-down" data-id="${item.id}"></i>
                                </div>
                            </div>
                        `;
                    });
                    cartContent.innerHTML = result;
                })
                .catch(error => {
                    console.error('Error fetching cart items:', error);
                    // Handle error, such as displaying a message to the user
                });
        });






        function checkLoginStatus() {
            fetch('/check-login')
                .then(response => response.json())
                .then(data => {
                    if (data.loggedIn) {
                        // User is logged in, show logout button and hide login and sign up buttons
                        document.getElementById('logoutBtn').style.display = 'block';
                        document.querySelectorAll('.nav-item')[0].style.display = 'none'; // Hide login button
                        document.querySelectorAll('.nav-item')[1].style.display = 'none';
                        fetchUserName(); // Call function to fetch and display username
                    } else {
                        // User is not logged in, hide logout button and show login and sign up buttons
                        document.getElementById('logoutBtn').style.display = 'none';
                        document.querySelectorAll('.nav-item')[0].style.display = 'block'; // Show login button
                        document.querySelectorAll('.nav-item')[1].style.display = 'block';
                        // If user is not logged in, remove username from UI
                        const usernameElement = document.getElementById('username');
                        if (usernameElement) {
                            usernameElement.remove();
                        }
                    }
                })
                .catch(error => console.error('Error checking login status:', error));
        }
        
        function fetchUserName() {
            fetch("/check-login")
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.loggedIn) {
                        const username = data.username;
                        // Check if username element already exists
                        const existingUsernameElement = document.getElementById('username');
                        if (!existingUsernameElement) {
                            // Create a new span element for the username
                            const usernameElement = document.createElement("span");
                            usernameElement.textContent = `Welcome, ${username}`;
                            usernameElement.id = 'username'; // Set id for easy removal if user logs out
                            // Get the userContainer element
                            const userContainer = document.getElementById('userContainer');
                            // Insert the username element after the userContainer
                            userContainer.insertAdjacentElement("afterend", usernameElement);
                        }
                    } else {
                        // If user is not logged in, remove username from UI
                        const usernameElement = document.getElementById('username');
                        if (usernameElement) {
                            usernameElement.remove();
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching username:', error);
                });
        }
        

        // Call checkLoginStatus when the DOM content is loaded
        document.addEventListener("DOMContentLoaded", checkLoginStatus);
        

    function logoutUser() {
        fetch('/logout', { method: 'GET' })
            .then(response => {
                // Update the UI to show login and sign up buttons after logout
                document.getElementById('logoutBtn').style.display = 'none';
                document.querySelectorAll('.nav-item')[0].style.display = 'block'; // Hide login button
                    document.querySelectorAll('.nav-item')[1].style.display = 'block';
                if (response.redirected) {
                    // Redirect to the home page after logout
                    window.location.href = response.url;
                } else {
                    console.error('Logout failed');
                }
            })
            .catch(error => console.error('Error logging out:', error));
    }

    // Call the function to check login status when the page loads
    window.addEventListener('load', checkLoginStatus);



    // JavaScript to toggle navbar visibility on click
document.addEventListener("DOMContentLoaded", () => {
    const navbarToggle = document.querySelector(".navbar-toggler");
    const navbarCollapse = document.querySelector(".navbar-collapse");

    navbarToggle.addEventListener("click", () => {
        navbarCollapse.classList.toggle("show");
    });
});


    </script>

    <script src="app.js"></script>
</body>
</html>
